/**
 * highcharts-ng
 * @version v0.0.5-dev - 2014-02-28
 * @link https://github.com/pablojim/highcharts-ng
 * @author Barry Fitzgerald <>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("highcharts-ng",[]).directive("highchart",function(){function a(a,b,c){var d=a[b];a[b]=function(){var a=Array.prototype.slice.call(arguments);return c.apply(this,a),d?d.apply(this,a):void 0}}function b(a,c){for(var d in c)c[d]&&c[d].constructor&&c[d].constructor===Object?(a[d]=a[d]||{},b(a[d],c[d])):a[d]=c[d];return a}var c=function(a,b,c){void 0===c&&(c=0),0>c&&(c+=a.length),0>c&&(c=0);for(var d=a.length;d>c;c++)if(c in a&&a[c]===b)return c;return-1},d=0,e=function(a){var b=!1;return angular.forEach(a,function(a){angular.isDefined(a.id)||(a.id="series-"+d++,b=!0)}),b},f=["xAxis","yAxis"],g=function(c,d,e){var g={},h={chart:{events:{}},title:{},subtitle:{},series:[],credits:{},plotOptions:{},navigator:{enabled:!1}};return g=e.options?b(h,e.options):h,g.chart.renderTo=d[0],angular.forEach(f,function(b){e[b]&&(a(g.chart.events,"selection",function(a){var d=this;c.$apply(a[b]?function(){c.config[b].currentMin=a[b][0].min,c.config[b].currentMax=a[b][0].max}:function(){c.config[b].currentMin=d[b][0].dataMin,c.config[b].currentMax=d[b][0].dataMax})}),a(g.chart.events,"addSeries",function(){c.config[b].currentMin=this[b][0].min||c.config[b].currentMin,c.config[b].currentMax=this[b][0].max||c.config[b].currentMax}),g[b]=angular.copy(e[b]))}),e.title&&(g.title=e.title),e.subtitle&&(g.subtitle=e.subtitle),e.credits&&(g.credits=e.credits),g},h=function(a,b){var c=a.getExtremes();(b.currentMin!==c.dataMin||b.currentMax!==c.dataMax)&&a.setExtremes(b.currentMin,b.currentMax,!1)},i=function(a,b,c){(b.currentMin||b.currentMax)&&a[c][0].setExtremes(b.currentMin,b.currentMax,!0)},j=function(a){return angular.extend({},a,{plotBands:null,plotLines:null})},k=function(a){return angular.extend({},a,{data:null,visible:null})};return{restrict:"EAC",replace:!0,template:"<div></div>",scope:{config:"="},link:function(a,b){var d={},l=function(a,b){var c=!1,e=o[b][0],f=j(a);if(angular.equals(d[b],f)){for(var g=0;g<e.plotLinesAndBands.length;g++)e.removePlotBandOrLine(e.plotLinesAndBands[g].id);angular.forEach(["plotBands","plotLines"],function(b){if(a.hasOwnProperty(b))for(var c=0;c<a[b].length;c++)e.addPlotBandOrLine(a[b][c],b)})}else e.update(angular.copy(a),!1),h(e,a),d[b]=f,c=!0;return c},m={},n=function(a){var b=[];if(a){var d=e(a);if(d)return!1;angular.forEach(a,function(a){b.push(a.id);var c=o.get(a.id);c?angular.equals(m[a.id],k(a))?(void 0!==a.visible&&c.visible!==a.visible&&c.setVisible(a.visible,!1),c.setData(angular.copy(a.data),!1)):c.update(angular.copy(a),!1):o.addSeries(angular.copy(a),!1),m[a.id]=k(a)})}for(var f=o.series.length-1;f>=0;f--){var g=o.series[f];c(b,g.options.id)<0&&g.remove(!1)}return!0},o=!1,p=function(){o&&o.destroy(),m={},d={};var c=a.config||{},e=g(a,b,c);o=c.useHighStocks?new Highcharts.StockChart(e):new Highcharts.Chart(e);for(var h=0;h<f.length;h++)c[f[h]]&&i(o,c[f[h]],f[h]);c.loading&&o.showLoading()};p(),a.$watch("config.series",function(a){var b=n(a);b&&o.redraw()},!0),a.$watch("config.title",function(a){o.setTitle(a,!0)},!0),a.$watch("config.subtitle",function(a){o.setTitle(!0,a)},!0),a.$watch("config.loading",function(a){a?o.showLoading():o.hideLoading()}),a.$watch("config.credits.enabled",function(a){a?o.credits.show():o.credits&&o.credits.hide()}),a.$watch("config.useHighStocks",function(){p()}),angular.forEach(f,function(b){a.$watch("config."+b,function(a,c){a!==c&&a&&l(a,b)&&o.redraw()},!0)}),a.$watch("config.options",function(a,b,c){a!==b&&(p(),n(c.config.series),o.redraw())},!0),a.$on("$destroy",function(){o&&o.destroy(),b.remove()})}}});